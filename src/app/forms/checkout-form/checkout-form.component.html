<mat-vertical-stepper [linear]="isLinear" #stepper>


  <mat-step [stepControl]="saFormGroup" [ngSwitch]="this.currentStatus">

    <div *ngSwitchCase="Status.loggedWithoutAddress">
      <ng-template matStepLabel>Shipping Address</ng-template>
      <form [formGroup]="saFormGroup">
        <div formGroupName="customer">
          <mat-form-field>
            <label>
              <input matInput placeholder="First name" formControlName="firstName" required>
            </label>
          </mat-form-field>
          <mat-form-field>
            <label>
              <input matInput placeholder="Last name" formControlName="lastName" required>
            </label>
          </mat-form-field>
          <br>
          <mat-form-field>
            <label>
              <input matInput placeholder="phone number" formControlName="phoneNumber" required>
            </label>
          </mat-form-field>
          <br>
        </div>
        <div formGroupName="address">
          <mat-form-field>
            <label>
              <input matInput placeholder="street 1" formControlName="street1"
                     [ngbTypeahead]="search"
                     required>
              <small *ngIf="searching" class="form-text text-muted">searching...</small>
            </label>
          </mat-form-field>
          <br>
          <mat-form-field>
            <label>
              <input matInput placeholder="street 2" formControlName="street2">
            </label>
          </mat-form-field>
          <br>
          <mat-form-field>
            <label>
              <input matInput placeholder="city" formControlName="city" required>
            </label>
          </mat-form-field>
          <br>
          <mat-form-field>
            <label>
              <input matInput placeholder="province" formControlName="province" required>
            </label>
          </mat-form-field>
          <br>
          <mat-form-field>
            <label>
              <input matInput placeholder="postal code" formControlName="postalCode" required>
            </label>
          </mat-form-field>
          <br>
          <mat-form-field>
            <label>
              <input matInput placeholder="country" formControlName="country" required>
            </label>
          </mat-form-field>
        </div>
        <div>
          <button class="proceed" mat-button matStepperNext (click)="onSubmitSaFormGroup(saFormGroup)">Proceed to
            Billing
          </button>
        </div>
      </form>
    </div>
    <div *ngSwitchCase="Status.notLogged">
      <ng-template matStepLabel>Shipping Address</ng-template>
      <form [formGroup]="saFormGroup">
        <div formGroupName="customer">
          <mat-form-field>
            <label>
              <input matInput placeholder="First name" formControlName="firstName" required>
            </label>
          </mat-form-field>
          <mat-form-field>
            <label>
              <input matInput placeholder="Last name" formControlName="lastName" required>
            </label>
          </mat-form-field>
          <br>
          <mat-form-field>
            <label>
              <input matInput placeholder="phone number" formControlName="phoneNumber" required>
            </label>
          </mat-form-field>
          <br>
        </div>
        <div formGroupName="address">
          <mat-form-field>
            <label>
              <input matInput placeholder="street 1" formControlName="street1"
                     [ngbTypeahead]="search"
                     required>
              <small *ngIf="searching" class="form-text text-muted">searching...</small>
            </label>
          </mat-form-field>
          <br>
          <mat-form-field>
            <label>
              <input matInput placeholder="street 2" formControlName="street2">
            </label>
          </mat-form-field>
          <br>
          <mat-form-field>
            <label>
              <input matInput placeholder="city" formControlName="city" required>
            </label>
          </mat-form-field>
          <br>
          <mat-form-field>
            <label>
              <input matInput placeholder="province" formControlName="province" required>
            </label>
          </mat-form-field>
          <br>
          <mat-form-field>
            <label>
              <input matInput placeholder="postal code" formControlName="postalCode" required>
            </label>
          </mat-form-field>
          <br>
          <mat-form-field>
            <label>
              <input matInput placeholder="country" formControlName="country" required>
            </label>
          </mat-form-field>
        </div>
        <div>
          <button class="proceed" mat-button matStepperNext (click)="onSubmitSaFormGroup()">Proceed to
            Billing
          </button>
        </div>
      </form>
    </div>

    <div *ngSwitchCase="Status.loggedWithAddress">
      <ng-template matStepLabel>Shipping Address</ng-template>
      <div>
        <mat-radio-group
          class="example-radio-group" [(ngModel)]="this.addressSelected">
          <mat-radio-button class="example-radio-button" [value]="address"
                            *ngFor="let address of addressList" (click)="clickOnExistShippingAddress(address)"
          >
            <p>{{address.customer.firstName + ' ' + address.customer.lastName}}</p>
            <p>{{address.customer.phoneNumber}}</p>
            <p>{{address.address.street1}}</p>
            <p>{{address.address.street2}}</p>
            <p>{{address.address.city + ', ' + address.address.province + ', ' + address.address.country}}</p>
            <p>{{address.address.postalCode}}</p>
          </mat-radio-button>
        </mat-radio-group>

      </div>
      <button type="button" *ngIf="!this.isAddingAddress" mat-stroked-button id="add" data-toggle="collapse"
              data-target="#newAddressForm" aria-expanded="true"
              aria-controls="collapseExample" color="primary"
              (click)="triggerAddressForm()">Add a new address
      </button>
      <div id="newAddressForm" class="collapse">
        <form [formGroup]="saFormGroup">

          <div formGroupName="customer">
            <mat-form-field>
              <label>
                <input matInput placeholder="First name" formControlName="firstName" required>
              </label>
            </mat-form-field>
            <mat-form-field>
              <label>
                <input matInput placeholder="Last name" formControlName="lastName" required>
              </label>
            </mat-form-field>
            <br>
            <mat-form-field>
              <label>
                <input matInput placeholder="phone number" formControlName="phoneNumber" required>
              </label>
            </mat-form-field>
            <br>
          </div>
          <div formGroupName="address">
            <mat-form-field>
              <label>
                <input matInput placeholder="street 1" formControlName="street1"
                       [ngbTypeahead]="search"
                       required>
                <small *ngIf="searching" class="form-text text-muted">searching...</small>
              </label>
            </mat-form-field>
            <br>
            <mat-form-field>
              <label>
                <input matInput placeholder="street 2" formControlName="street2">
              </label>
            </mat-form-field>
            <br>
            <mat-form-field>
              <label>
                <input matInput placeholder="city" formControlName="city" required>
              </label>
            </mat-form-field>
            <br>
            <mat-form-field>
              <label>
                <input matInput placeholder="province" formControlName="province" required>
              </label>
            </mat-form-field>
            <br>
            <mat-form-field>
              <label>
                <input matInput placeholder="postal code" formControlName="postalCode" required>
              </label>
            </mat-form-field>
            <br>
            <mat-form-field>
              <label>
                <input matInput placeholder="country" formControlName="country" required>
              </label>
            </mat-form-field>
          </div>
          <button type="reset" mat-stroked-button color="warn" data-toggle="collapse" data-target="#newAddressForm"
                  (click)="this.saFormGroup.reset(); this.triggerAddressForm()">Cancel
          </button>
          <button mat-stroked-button color="primary" data-toggle="collapse" data-target="#newAddressForm"
                  (click)="this.addAddressToDB()" [disabled]="!this.saFormGroup.valid">Save
          </button>
        </form>
      </div>
    </div>
    <div>
      <button type="button" class="proceed" mat-button matStepperNext
              (click)="onSubmitSaFormGroup()"
              [disabled]="this.addressSelected===null || !this.saFormGroup.valid || this.isAddingAddress">
        Proceed to
        Billing
      </button>
    </div>

    <div *ngSwitchDefault>
      <div class="spinner-grow text-dark" role="status">
        <span class="sr-only">Loading...</span>
      </div>
    </div>

  </mat-step>


  <mat-step [stepControl]="baFormGroup">
    <ng-template matStepLabel>Billing Address</ng-template>
    <mat-checkbox class="example-margin" [(ngModel)]="sameAddress" (click)="changeBAform()">My billing address is the
      same as my shipping
      address
    </mat-checkbox>
    <form *ngIf="!sameAddress" [formGroup]="baFormGroup">
      <div formGroupName="customer">
        <mat-form-field>
          <label>
            <input matInput placeholder="First name" formControlName="firstName" required>
          </label>
        </mat-form-field>
        <mat-form-field>
          <label>
            <input matInput placeholder="Last name" formControlName="lastName" required>
          </label>
        </mat-form-field>
        <br>
        <mat-form-field>
          <label>
            <input matInput placeholder="phone number" formControlName="phoneNumber" required>
          </label>
        </mat-form-field>
        <br>
      </div>
      <div formGroupName="address">
        <mat-form-field>
          <label>
            <input matInput placeholder="street 1" formControlName="street1" required>
          </label>
        </mat-form-field>
        <br>
        <mat-form-field>
          <label>
            <input matInput placeholder="street 2" formControlName="street2">
          </label>
        </mat-form-field>
        <br>
        <mat-form-field>
          <label>
            <input matInput placeholder="city" formControlName="city" required>
          </label>
        </mat-form-field>
        <br>
        <mat-form-field>
          <label>
            <input matInput placeholder="province" formControlName="province" required>
          </label>
        </mat-form-field>
        <br>
        <mat-form-field>
          <label>
            <input matInput placeholder="postal code" formControlName="postalCode" required>
          </label>
        </mat-form-field>
        <br>
        <mat-form-field>
          <label>
            <input matInput placeholder="country" formControlName="country" required>
          </label>
        </mat-form-field>
      </div>
      <div>
        <button mat-button matStepperPrevious>Back</button>
        <button mat-button matStepperNext>Next</button>
      </div>
    </form>

  </mat-step>
  <mat-step>
    <ng-template matStepLabel>Payment</ng-template>
    <form [formGroup]="ccFormGroup" id="payment-form">
      <mat-form-field>

        <label>
          <input matInput placeholder="First name" formControlName="firstName" required>
        </label>
      </mat-form-field>
      <mat-form-field>
        <label>
          <input matInput placeholder="Last name" formControlName="lastName" required>
        </label>
      </mat-form-field>
      <br>
      <mat-form-field>
        <label>
          <input matInput placeholder="Card Number" formControlName="cardNumber" required>
        </label>
      </mat-form-field>
      <br>
      <mat-form-field>
        <label>
          <input matInput placeholder="Expire Date" formControlName="expireDate" required>
        </label>
      </mat-form-field>
      <mat-form-field>
        <label>
          <input matInput placeholder="CVV" formControlName="cvv" required>
        </label>
      </mat-form-field>
    </form>
  </mat-step>
</mat-vertical-stepper>
